"use strict";PULSE.app.templates.fulltimewinner='<h4 class="kotm-player__vote">Fan Vote</h4> <h4 class="kotm-player__first-name js-motm-first-name">{{ firstName }}</h4> <h3 class="kotm-player__second-name js-motm-last-name">{{ lastName }}</h3> <div class="kotm-player__player-image-wrapper"> <img class="kotm-player__player-image kotm-player__player-image--promo js-winner-image" data-player="{{ id }}" src="{{ image }}"> </div> <div class="kotm-player__bowtie kotm-player__bowtie--opt-out"> <h3 class="kotm-player__bowtie-text">{{ kotmTitle }}</h3> </div> <div class="kotm-live-commentary__button-link-container js-button-link-container"> <button class="kotm-live-commentary__btn">{{ resultsBtnText }}{{{ icnRight }}}</button> </div> ',PULSE.app.templates.livebutton='<button class="kotm-live-commentary__btn">{{ liveBtnText }}{{{ icnRight }}}</button> ',PULSE.app.templates.matchlist='{{#.}} <h2 class="kotm-match-list__title">Matchweek {{matchweek}}</h2> <div class="kotm-match-list"> <div class="kotm-match-list__header"> <span class="kotm-match-list__column-title kotm-match-list__column-title--date u-text-left">{{ headerDate }}</span> <span class="kotm-match-list__column-title kotm-match-list__column-title--match">{{ headerFixture }}</span> <span class="kotm-match-list__column-title kotm-match-list__column-title--player u-text-left">{{ headerKotm }}</span> </div> <ul class="js-kotm-fixtures"> {{#matchweekFixtures}} <li class="kotm-match-list__row js-kotm-row" data-fixture="{{ optaMatchId }}" data-match="{{ matchId }}" data-player="{{ winner.name }}"> <div class="kotm-match-list__time"> <span class="kotm-match-list__time--large">{{fixtureTime}}</span> <span class="kotm-match-list__time--small">{{fixtureTimeSmall}}</span> </div> <div class="kotm-match-list__match-container u-text-center"> <div class="kotm-match-list__fixture"> <span class="kotm-match-list__team-name u-text-right"> {{homeTeam.teamShortName}} </span> <img class="kotm-match-list__badge" src="{{ homeTeam.badge }}" srcset="{{ homeTeam.badge }}, {{ homeTeam.badge }} 2x"> <div class="kotm-match-list__scoreboard"> {{homeTeam.score}}<span>-</span>{{awayTeam.score}} </div> <img class="kotm-match-list__badge" src="{{ awayTeam.badge }}" srcset="{{ awayTeam.badge }}, {{ awayTeam.badge }} 2x"> <span class="kotm-match-list__team-name u-text-left"> {{awayTeam.teamShortName}} </span> </div> <div class="kotm-match-list__fixture-small"> <span>{{ homeTeam.teamAbbreviatedName }}</span> <div class="kotm-match-list__scoreboard"> {{homeTeam.score}}<span>-</span>{{awayTeam.score}} </div> <span>{{ awayTeam.teamAbbreviatedName }}</span> </div> </div> <div class="kotm-match-list__player-container"> <img class="kotm-match-list__player-img js-kotm-image" data-player="{{ winner.id }}" data-size="" src=""> <span class="kotm-match-list__player-name">{{ winner.name }}</span> <span class="kotm-match-list__player-name-small"> <span class="kotm-match-list__player-name-small--light">{{ winner.firstName }}</span> <strong class="kotm-match-list__player-name-small--bold u-show">{{ winner.lastName }}</strong> </span> <svg class="kotm-match-list__arrow" xmlns="http://www.w3.org/2000/svg" width="16" height="10" viewBox="0 0 16 10"> <path d="M15.27 4.998c-.012-.274-.102-.56-.312-.753h-.001l-1.171-1.172-1.872-1.872-.429-.428c-.193-.193-.481-.313-.754-.314-.261 0-.573.116-.753.314-.185.203-.324.469-.314.753.012.283.109.549.314.754l1.174 1.174.478.478H3.32c-.5 0-1.004-.006-1.505 0h-.021c-.275 0-.56.12-.754.314-.186.186-.324.486-.313.753.012.275.102.561.313.754.21.193.467.314.754.313H11.635l-1.228 1.227-.43.43c-.193.193-.312.48-.313.753 0 .262.115.574.313.754.203.185.47.324.754.313.282-.014.549-.109.753-.313l1.175-1.175 1.871-1.872.43-.429c.109-.109.186-.239.237-.378.049-.123.079-.254.074-.378"/> </svg> </div> </li> {{/matchweekFixtures}} </ul> </div> {{/.}}',PULSE.app.templates.matchlistnodata='<tr> <td class="kotm-match-list__no-fixtures" colspan="3">{{ message }}</td> </tr>',PULSE.app.templates.modalfixturestattable='<div class="kotm-results__fixture bg-{{ optaId }}"> <div class="kotm-results__fixture-player"> <div class="kotm-results__background"> {{{ brandGradientSvg }}} {{{ colouredBrandSVG }}} </div> <div class="kotm-results__player-details"> <h2>{{ first_name }}</h2> <h2>{{ last_name }}</h2> <h4>{{ position }} </h4></div> <div class="kotm-results__player-image-wrapper"> <img class="kotm-results__player-image js-winner-image" data-player="{{ id }}" src="{{ image }}"> </div> </div> <div class="kotm-results__fixture-stats"> {{#stats}} <div class="kotm-results__fixture-stats-row"> <span class="kotm-results__fixture-stats-value">{{ name }}</span> <span class="kotm-results__fixture-stats-value kotm-results__fixture-stats-value--bold">{{ value }}</span> </div> {{/stats}} </div> <a class="btn widget-button" href="{{ playerUrl }}"> Player Profile <svg class="icn" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 15.085 9.422" xml:space="preserve"> <path d="M15.084,4.709c-0.013-0.285-0.106-0.581-0.325-0.782l-1.215-1.216l-1.941-1.94l-0.445-0.446 c-0.21-0.204-0.489-0.32-0.782-0.325c-0.271,0-0.595,0.12-0.781,0.325C9.403,0.536,9.259,0.812,9.27,1.107 c0.012,0.294,0.112,0.569,0.325,0.781l1.218,1.218l0.495,0.496H2.69c-0.519,0-1.041-0.006-1.56,0H1.107 c-0.285,0-0.58,0.124-0.781,0.326C0.133,4.12-0.01,4.432,0.001,4.709C0.014,4.993,0.107,5.29,0.326,5.49 c0.218,0.2,0.484,0.326,0.781,0.325h10.207L10.04,7.088L9.595,7.533c-0.2,0.2-0.324,0.5-0.325,0.782c0,0.271,0.12,0.595,0.325,0.781 c0.21,0.192,0.486,0.337,0.782,0.325c0.292-0.015,0.57-0.113,0.781-0.325l1.218-1.218l1.941-1.941l0.445-0.445 c0.114-0.113,0.194-0.248,0.247-0.392c0.052-0.124,0.078-0.258,0.076-0.392L15.084,4.709z"/> </svg> </a> </div> ',PULSE.app.templates.modalresulttable='<table class="kotm-results__results-table table"> <thead class="kotm-results__results-table-head"> <tr> <th class="kotm-results__results-table-cell kotm-results__results-table-cell--left" scope="col">Pos</th> <th class="kotm-results__results-table-cell kotm-results__results-table-cell--left" scope="col">Player</th> <th class="kotm-results__results-table-cell" scope="col">Team</th> <th class="kotm-results__results-table-cell kotm-results__results-table-cell--right" scope="col">Votes %</th> </tr> </thead> <tbody> {{#players}} <tr> <td class="kotm-results__results-table-cell kotm-results__results-table-cell--left" scope="col">{{index}}</td> <td class="kotm-results__results-table-cell kotm-results__results-table-cell--left" scope="col">{{firstName}} {{lastName}}</td> <td class="kotm-results__results-table-cell" scope="col"> <span class="kotm-results__results-badge badge badge-image-container" data-widget="club-badge-image" data-size="50"> <img class="badge-image badge-image--50 js-badge-image" src="{{ clubBadge }}" srcset="{{ clubBadge }}, {{ clubBadgeRetina }} 2x"> </span> </td> <td class="kotm-results__results-table-cell kotm-results__results-table-cell--right" scope="col">{{ score }}</td> </tr> {{/players}} </tbody> </table> <p class="kotm-results__total-results">{{totalVotes}} Total Votes</p> ',PULSE.app.templates.modalwinner='<h4 class="kotm-player__vote">Fan Vote</h4> <h4 class="kotm-player__first-name">{{ firstName }}</h4> <h3 class="kotm-player__second-name">{{ lastName }}</h3> <div class="kotm-player__player-image-wrapper"> <img class="kotm-player__player-image js-winner-image" data-player="{{ id }}" src="{{ image }}"> </div> <div class="kotm-player__bowtie kotm-player__bowtie--opt-out"> <h3 class="kotm-player__bowtie-text">{{ kotmTitle }}</h3> </div> ',PULSE.app.templates.playerstatnew='<div class="kotm-match-list kotm-player-stats"> <div class="kotm-player-stats__header kotm-match-list__header"> <span class="kotm-player-stats__column-title kotm-player-stats__column-title--player">{{ playerHeader }}</span> <span class="kotm-player-stats__column-title kotm-player-stats__column-title--wins"> <span class="kotm-player-stats__stat-container--title">{{ statHeaderDesktop }}</span> <span class="js-stat-column">{{ statHeader }}</span> </span> </div> <ul class="js-kotm-table-body"> {{#.}} <li class="kotm-player-stats__row"> <div class="kotm-match-list__player-container kotm-player-stats__player-container--data"> <img class="img kotm-match-list__player-img" data-player="{{ optaId }}" data-size="{{ imageSize }}" src="{{ playerImage }}" alt="{{ labelFor }} {{ firstName }} {{ lastName }}"> <span class="kotm-match-list__player-name">{{ playerFirstName }} {{ playerLastName }}</span> <span class="kotm-match-list__player-name-small"> <span class="kotm-match-list__player-name-small--light">{{ playerFirstName }}</span> <strong class="kotm-match-list__player-name-small--bold u-show">{{ playerLastName }}</strong> </span> </div> <div class="kotm-player-stats__stat-container kotm-player-stats__stat-container--data"> <span>{{ statValue }}</span> </div> </li> {{/.}} </ul> </div>',PULSE.app.templates.playerstatnext='{{#.}} <li class="kotm-player-stats__row"> <div class="kotm-match-list__player-container kotm-player-stats__player-container--data"> <img class="img kotm-match-list__player-img" data-player="{{ optaId }}" data-size="{{ imageSize }}" src="{{ playerImage }}" alt="{{ labelFor }} {{ firstName }} {{ lastName }}"> <span class="kotm-match-list__player-name">{{ playerFirstName }} {{ playerLastName }}</span> <span class="kotm-match-list__player-name-small"> <span class="kotm-match-list__player-name-small--light">{{ playerFirstName }}</span> <strong class="kotm-match-list__player-name-small--bold u-show">{{ playerLastName }}</strong> </span> </div> <div class="kotm-player-stats__stat-container kotm-player-stats__stat-container--data"> <span>{{ statValue }}</span> </div> </li> {{/.}}',PULSE.app.templates.playervote='<div class="col-6 col-6-m col-6-s kotm-players__col bg-{{ optaId }} {{#alt}}kotm-players__col--alt kotm-players__col-border{{/alt}}"> <span class="kotm-players__team u-hide-mob {{#alt}}kotm-players__team--alt{{/alt}}">{{ team }}</span> <span class="kotm-players__team u-show-mob kotm-players__team--mob {{#alt}}kotm-players__team--alt{{/alt}}">{{ shortName }}</span> <ul> {{ #players }} <li class="kotm-players__list-item"> <button class="kotm-players__item {{#alt}}kotm-players__item--alt {{/alt}} js-player js-player-{{ id }}" data-player-id="{{ id }}"> <span class="kotm-players__name {{#alt}}kotm-players__name--alt {{/alt}}"> {{ firstName }} <strong>{{ lastName }}</strong> </span> <div class="kotm-players__img-container {{#alt}}kotm-players__img-container--alt {{/alt}}"> <div class="kotm-players__img-mask"></div> <div class="kotm-players__img-wrapper"> <img class="kotm-players__img js-candidate-image" src="{{ playerImage }}" data-player="{{ id }}"> </div> <div class="kotm-players__score js-score"> {{ score }} </div> </div> </button> </li> {{ /players }} </ul> </div> ',PULSE.app.templates.uservoted='<a class="kotm-live-commentary__voted-link">{{ resultsSoonText }}<span class="icn arrow-rightwhite"></span></a> ',function(t,e,a){const s="kotm-modal--active",l="kotm-players__item--active",o="kotm-modal__submit-container--disabled";t.KotmVoting=function(t,e,s){const l=this;l.container=t,l.home=l.container.dataset.home,l.optaId=e,l.fixtureId=s,l.prompt=l.container.querySelector(".js-prompt"),l.storage="kotm-"+l.optaId,l.storageValue=a.localStorage.getStorage(l.storage),l.players=l.container.querySelector(".js-players"),l.submitContainer=l.container.querySelector(".js-submit-container"),l.submit=l.container.querySelector(".js-submit-vote"),l.close=l.container.querySelector(".js-close"),l.render=!1,l.winnerRendered=!1,l.modalData={},l.request()},t.KotmVoting.prototype.request=function(){const e=this,s={url:t.environment.api+"/voting/premierleague/results/"+e.optaId,target:e,method:"GET",forceCallback:!0,callback:e.onVoteData,headers:[t.accountHeader],interval:5e3};e.votePoll=a.data.manager.add(s)},t.KotmVoting.prototype.checkImageError=function(t){const s=this;!t&&s.errorCheckTimes<10&&(s.errorCheckTimes+=1,setTimeout((function(){s.checkImageError()}),500)),t.onerror=function(){a.style.addClass(t,"kotm-players__img--default");const s=t.closest(" button").dataset.playerId;e.setPlayerImageLoader(s,"250x250",t)}},t.KotmVoting.prototype.checkThumbnailsLoaded=function(){const t=this;document.querySelectorAll(".js-candidate-image").forEach((function(e){t.checkImageError(e)}))},t.KotmVoting.prototype.onVoteData=function(e){const l=this;if(l.modalData=e,!e||e.errors&&e.errors.length)return;if(l.startTime=e.metadata.startTime,l.endTime=e.metadata.endTime,Date.now()>l.endTime&&!l.winnerRendered&&(l.votePoll.stop(),l.winnerRendered=!0,a.style.hasClass(l.container,s)&&(l.display(),setTimeout((function(){l.display()}),700)),setTimeout((function(){l.resultsController=new t.KotmResults(l.container,e,l.fixtureId)}),500)),0!==e.errors.length||l.render)l.updateScores(e.pollResult.results);else{const a=r(e.pollResult.results);for(let e in a)Object.prototype.hasOwnProperty.call(a,e)&&(a[e].alt=n(l.home,e),a[e].optaId=e,l.players.innerHTML+=Mustache.render(t.templates.playervote,a[e]),l.checkThumbnailsLoaded());l.setListeners(),l.render=!0,l.storageValue&&l.showResults()}},t.KotmVoting.prototype.setListeners=function(){const t=this;t.playerBtns=t.container.querySelectorAll(".js-player"),Array.prototype.map.call(t.playerBtns,(function(e){e.addEventListener("click",(function(e){t.removeActivePlayerStates(),a.style.addClass(e.currentTarget,l),a.style.removeClass(t.submitContainer,o)}))})),t.submit.addEventListener("click",t.submitVote.bind(t)),t.close.addEventListener("click",(function(){t.display()}))},t.KotmVoting.prototype.submitVote=function(){const e=this,s=e.players.querySelector("."+l);e.storageValue=s.dataset.playerId,a.localStorage.setStorage(e.storage,e.storageValue);const o={url:`${t.environment.api}/voting/premierleague/vote/${e.optaId}/candidate/${e.storageValue}`,method:"PUT",target:e,headers:[t.accountHeader],forceCallback:!0,callback:e.hasVoted};a.data.request(o.url,o.method,o.callback,o.target,null,null,o.headers)},t.KotmVoting.prototype.hasVoted=function(t){const e=this;0===t.errors.length&&(e.updateScores(t.pollResult.results),e.removeActivePlayerStates(),e.showResults())},t.KotmVoting.prototype.updateScores=function(t){const e=this;t.forEach((function(t){const a=t.id;e.players.querySelector(".js-player-"+a).querySelector(".js-score").innerHTML=t.score}))},t.KotmVoting.prototype.showResults=function(){const t=this;if(t.prompt.innerHTML="Thanks for voting – result coming soon",a.style.addClass(t.submitContainer,o),a.style.addClass(t.players,"kotm-players--show-results"),t.storageValue){const e=t.players.querySelector('[data-player-id="'+t.storageValue+'"]');a.style.addClass(e,"kotm-players__item--voted")}},t.KotmVoting.prototype.display=function(){a.style.toggleClass(this.container,s)},t.KotmVoting.prototype.removeActivePlayerStates=function(){Array.prototype.map.call(this.playerBtns,(function(t){a.style.removeClass(t,l)}))};const r=function(t){let a={};return t.forEach((function(t){const s=t.optaTeamId;t.playerImage=e.getPlayerImg(t.id,"110x140"),a[s]||(a[s]=[],a[s].team=t.teamName,a[s].shortName=t.teamShortName,a[s].players=[]),a[s].players.push(t)})),a},n=function(t,e){return t!==e}}(PULSE.app,PULSE.app.common,PULSE.core),function(t,e,a,s){const l="U",o="A",r="L",n="C",i="full-time",c="user-voted",m="live",p={"full-time":"is-full-time","user-voted":"is-user-voted",live:"is-live"},u="u-hide",d="label.kotm.viewallresults",y="label.kotm.manofthematch",g="label.kotm.resultscomingsoon",h="label.kotm.votenow",k="View all results",_="Man of the match",f="Results coming soon",b="Vote Now",v=function(t,e){a.style.hasClass(t,e)&&a.style.removeClass(t,e)},S=function(t,e){return t===e};t.KotmController=function(e){const a=this;a.container=e,a.contentContainer=a.container.querySelector(".js-content"),a.modal=document.querySelector(".js-kotm-modal"),a.btnLinkContainer=a.container.querySelector(".js-button-link-container"),a.fixtureStatus=a.container.parentElement.dataset.fixtureStatus,a.fixtureId=a.container.parentElement.dataset.fixtureId,a.optaId=a.container.parentElement.dataset.optaId,a.compId=parseInt(a.container.parentElement.dataset.compId),a.compId>=t.kotmSeason&&a.checkFixtureStatus()},t.KotmController.prototype.checkFixtureStatus=function(){const t=this;t.fixtureStatus===l||t.fixtureStatus===o?t.startFixtureStatusPoll():t.onFixturesData({status:t.fixtureStatus})},t.KotmController.prototype.startFixtureStatusPoll=function(){const e=this;let s=t.common.createApiPath("fixtures.all",{});s+=`/${e.fixtureId}`;let l={url:s,target:e,method:"GET",forceCallback:!0,headers:[t.accountHeader],callback:e.onFixturesData,interval:3e4};e.fixtureStatusPoll=a.data.manager.add(l)},t.KotmController.prototype.onFixturesData=function(t){const e=this;v(e.container,u),e.fixtureStatus=t.status,e.fixtureStatus!==r&&e.fixtureStatus!==n||(e.fixtureStatus===r&&v(e.container,u),e.getVotingPoll(),e.fixtureStatusPoll&&e.fixtureStatusPoll.stop())},t.KotmController.prototype.getVotingPoll=function(e){const s=this;let l=a.object.objectByString(t.apiPath,"voting.results");l=`${t.environment.api}/${l}/${s.optaId}`;let o=e||s.pollStateController,r={url:l,target:s,headers:[t.accountHeader],method:"GET",callback:o};s.votingPoll=a.data.request(r.url,r.method,r.callback,r.target,null,null,r.headers)},t.KotmController.prototype.pollStateController=function(e){const s=this;if(!e||!e.pollResult)return void setTimeout(s.getVotingPoll.bind(s),5e3);s.startTime=e.metadata.startTime,s.endTime=e.metadata.endTime;const l=Date.now();if(v(s.container,u),s.voter||(s.voter=new t.KotmVoting(s.modal,s.optaId,s.fixtureId)),l>s.startTime&&l<s.endTime){a.localStorage.getStorage(`kotm-${s.optaId}`)?S(s.currentState,c)||s.userVoted():S(s.currentState,m)||s.renderLiveState()}else l>s.endTime&&s.getVotingPoll(s.processWinner);l<s.endTime&&setTimeout(s.pollStateController.bind(s,e),5e3)},t.KotmController.prototype.processWinner=function(e){const s=this;if(!e||!e.pollResult)return;const l=e.pollResult;var o,r;s.topPlayer=l.results[0],s.topPlayer.image=(o=s.topPlayer.id,t.environment.kotmPlayerImagePath+"150x302/"+o+"."+(r||"png")),s.topPlayer.cdn=t.environment.cdn,a.style.addClass(s.container,"is-winner"),a.style.addClass(s.container,`bg-${s.topPlayer.optaTeamId}`),S(s.currentState,i)||s.renderWinner()},t.KotmController.prototype.checkImageError=function(){const t=this,s=t.contentContainer.querySelector(".js-winner-image");!s&&t.errorCheckTimes<10&&(t.errorCheckTimes+=1,setTimeout((function(){t.checkImageError()}),500)),s.onerror=function(){a.style.addClass(t.container.querySelector(".js-winner-image"),"kotm-player__player-image--default"),e.setPlayerImageLoader(t.topPlayer.id,"250x250",s)}},t.KotmController.prototype.renderLiveState=function(){const a=this;let l=s.translations[h];l=l||b;const o={liveBtnText:l,icnRight:e.icon.renderSpriteSVG("arrow-right","icn","svg")};a.addRenderingClass(m),setTimeout((function(){a.btnLinkContainer.innerHTML=Mustache.render(t.templates.livebutton,o),a.currentState=m,v(a.container,u),a.setModalListener()}),600)},t.KotmController.prototype.userVoted=function(){const e=this;let a=s.translations[g];a=a||f;const l={resultsSoonText:a};e.addRenderingClass(c),setTimeout((function(){e.btnLinkContainer.innerHTML=Mustache.render(t.templates.uservoted,l),e.currentState=c,v(e.container,u),e.setModalListener()}),600)},t.KotmController.prototype.renderWinner=function(){const l=this;l.addRenderingClass(i),l.topPlayer.isOptOut&&a.style.addClass(l.container,"is-opt-out"),v(l.container,u),setTimeout((function(){let a=s.translations[d];a=a||k;let o=s.translations[y];o=o||_,l.topPlayer.resultsBtnText=a,l.topPlayer.kotmTitle=o,l.topPlayer.icnRight=e.icon.renderSpriteSVG("arrow-right","icn","svg"),l.contentContainer.innerHTML=Mustache.render(t.templates.fulltimewinner,l.topPlayer),l.currentState=i,l.errorCheckTimes=0,l.checkImageError(),l.clickEventAdded=!1,l.setModalListener()}),600)},t.KotmController.prototype.setModalListener=function(){const t=this,e=t.container.querySelector(".js-button-link-container");t.clickEventAdded||(e.addEventListener("click",(function(){t.voter.display()})),t.clickEventAdded=!0)},t.KotmController.prototype.addRenderingClass=function(t){const e=this;a.style.addClass(e.container,"is-animating"),setTimeout((function(){a.style.addClass(e.container,p[t])}),500),setTimeout((function(){for(let s in p)a.style.hasClass(e.container,p[s])&&s!==t&&a.style.removeClass(e.container,p[s]),a.style.removeClass(e.container,"is-animating")}),1e3)};let w=document.querySelector('[data-widget="kotm-controller"]');w&&(t.KotmController=new t.KotmController(w))}(PULSE.app,PULSE.app.common,PULSE.core,PULSE.I18N),function(t,e,a,s){const l="is-opt-out",o=s.lookup("label.kotm.playerofthematch"),r="u-hide",n={M:"Midfielder",D:"Defender",F:"Forward",G:"Goalkeeper"},i=function(t,a){return e.getPlayerImg(t,"110x140")},c=function(t,e){if(e)for(let a=0;a<e.length;a++)if(e[a].name===t)return e[a].value;return 0};let m;t.KotmResults=function(t,e,a){const s=this;s.container=t,s.votingContainer=s.container.querySelector(".js-kotm-voting"),s.modalContainer=s.container.querySelector(".js-kotm-modal-container"),s.resultsContainer=s.container.querySelector(".js-kotm-results"),s.tableContainer=s.container.querySelector(".js-table-container"),s.fixtureStatsContainer=s.container.querySelector(".js-fixture-stats-container"),s.tabs=s.container.querySelectorAll(".js-kotm-results-tabs li"),s.data=e,s.matchId=a,s.data&&(s.getWinnerFixtureStats(),s.setListeners())},t.KotmResults.prototype.setListeners=function(){Array.prototype.map.call(this.tabs,(function(e){e.addEventListener("click",(e=>{t.analytics.trackEvent({eventCategory:"KOTM Winners Modal",eventAction:"Clicked tab",eventLabel:e.target.innerText})}))}))},t.KotmResults.prototype.getWinnerFixtureStats=function(){const e=this;if(!e.data||!e.data.pollResult)return;e.players=e.data.pollResult.results,e.topPlayer=e.players[0];const s={id:e.topPlayer.id,fixtures:e.matchId,sys:"opta",altIds:!1,compCodeForActivePlayer:"EN_PR"};let l={url:t.common.createApiPath("stats.player",s),headers:[t.accountHeader],method:"GET",callback:e.gotWinnerFixtureStats,forceCallback:!0,target:e};a.data.request(l.url,l.method,l.callback,l.target,null,{},l.headers)},t.KotmResults.prototype.gotWinnerFixtureStats=function(a){const l=this;if(a.stats){const o=function(t){const a=t.entity,l=t.stats,o={first_name:e.splitDisplayName(a.name.display).first,last_name:e.splitDisplayName(a.name.display).last,playerUrl:e.generateContentUrl("player",a.id,a.name.display.replace(new RegExp(" ","g"),"-")),position:n[a.info.position],playerId:a.playerId};let r=parseInt(c("accurate_pass",l))/parseInt(c("total_pass",l));r=r||0;let i=parseFloat((100*r).toFixed(1))+"%";switch(a.info.position){case"F":o.stats=[{name:s.lookup("label.stat.goals"),value:c("goals",l)},{name:s.lookup("label.stat.assists"),value:c("goal_assist",l)},{name:s.lookup("label.stat.shotsOnTarget"),value:c("ontarget_scoring_att",l)},{name:s.lookup("label.stat.big_chance_created"),value:c("big_chance_created",l)},{name:s.lookup("label.stat.key_passes"),value:c("total_att_assist",l)},{name:s.lookup("label.stat.successfulDribbles"),value:c("won_contest",l)}];break;case"M":o.stats=[{name:s.lookup("label.stat.goals"),value:c("goals",l)},{name:s.lookup("label.stat.assists"),value:c("goal_assist",l)},{name:s.lookup("label.stat.big_chance_created"),value:c("big_chance_created",l)},{name:s.lookup("label.stat.key_passes"),value:c("total_att_assist",l)},{name:s.lookup("label.stat.passes_completion_per"),value:i},{name:s.lookup("label.stat.successfulDribbles"),value:c("won_contest",l)}];break;case"D":o.stats=[{name:s.lookup("label.stat.goals"),value:c("goals",l)},{name:s.lookup("label.stat.assists"),value:c("goal_assist",l)},{name:s.lookup("label.stat.goals_conceded"),value:c("goals_conceded",l)},{name:s.lookup("label.stat.interception"),value:c("interception",l)},{name:s.lookup("label.stat.won_tackle"),value:c("won_tackle",l)},{name:s.lookup("label.stat.passes_completion_per"),value:i}];break;case"G":o.stats=[{name:s.lookup("label.stat.goals_conceded"),value:c("goals_conceded",l)},{name:s.lookup("label.stat.saves"),value:c("saves",l)},{name:s.lookup("label.stat.penalty_save"),value:c("penalty_save",l)},{name:s.lookup("label.stat.ball_recovery"),value:c("ball_recovery",l)}]}return o}(a);l.topPlayer.firstName=o.first_name,l.topPlayer.lastName=o.last_name,document.querySelector(".js-motm-last-name")&&(document.querySelector(".js-motm-last-name").innerHTML=l.topPlayer.lastName,document.querySelector(".js-motm-first-name").innerHTML=l.topPlayer.firstName),o.optaId=l.topPlayer.optaTeamId,o.brandGradientSvg=e.icon.brandGradientSVG("-80 -70 750 150","kotm-results__svg kotm-results__gradient-svg"),o.colouredBrandSVG=e.icon.colouredBrandSVG("-80 -70 750 150","kotm-results__svg kotm-results__club-svg"),o.image=i(l.topPlayer.id),o.id=l.topPlayer.id,l.fixtureStatsContainer.innerHTML=Mustache.render(t.templates.modalfixturestattable,o),l.renderWinner()}},t.KotmResults.prototype.renderWinner=function(){const s=this,n=s.data;if(!n||!n.pollResult)return;const c=n.pollResult;s.players=c.results;for(let t=0;t<s.players.length;t++)s.players[t].index=t+1,s.players[t].clubBadge=e.getClubBadge(s.players[t].optaTeamId,"50"),s.players[t].clubBadgeRetina=e.getClubBadge(s.players[t].optaTeamId,"50",!0);s.topPlayer=s.players[0],s.topPlayer.image=i(s.topPlayer.id),s.topPlayer.cdn=t.environment.cdn,m&&a.style.removeClass(s.resultsContainer,`bg-${m}`),a.style.addClass(s.resultsContainer,`bg-${s.topPlayer.optaTeamId}`),a.style.removeClass(s.resultsContainer,r),a.style.addClass(s.modalContainer,"kotm-modal__container--results"),a.style.addClass(s.votingContainer,r),m=s.topPlayer.optaTeamId,s.topPlayer.isOptOut?a.style.addClass(s.resultsContainer,l):a.style.removeClass(s.resultsContainer,l);const p=s.resultsContainer.querySelector(".js-kotm-winner-container");s.topPlayer.kotmTitle=o,p.innerHTML=Mustache.render(t.templates.modalwinner,s.topPlayer);let u={optaId:s.topPlayer.optaTeamId,players:s.players,totalVotes:c.totalVotes};s.tableContainer.innerHTML=Mustache.render(t.templates.modalresulttable,u),t.clubBadge(s.tableContainer,!0),s.errorCheckTimes=0,s.checkImageError()},t.KotmResults.prototype.checkImageError=function(){const t=this,s=t.container.querySelector(".js-winner-image");!s&&t.errorCheckTimes<10&&(t.errorCheckTimes+=1,setTimeout((function(){t.checkImageError()}),500)),s.onerror=function(){a.style.addClass(t.container.querySelector(".js-winner-image"),"kotm-player__player-image--default"),e.setPlayerImageLoader(t.topPlayer.id,"250x250",s)}}}(PULSE.app,PULSE.app.common,PULSE.core,PULSE.I18N),function(t,e,a,s,l){const o="kotm-modal--active",r="u-hide";t.matchList=function(a){const s=this;s.element=a,s.fixtures=s.element.querySelector(".js-kotm-fixtures"),s.modal=document.querySelector(".js-kotm-modal"),s.modalClose=document.querySelector(".js-close"),s.loader=s.element.querySelector(".js-loader"),s.initalised=!1,s.filterElement=a.querySelector('[data-widget="results-filtered-list-filter"]');const l=t.filterGroups.kotmMatches;s.filterController=new t.common.listFilterController(s.filterElement,{dropdowns:l,delegate:s,tracking:!0}),s.modalClose.addEventListener("click",(()=>{e.style.toggleClass(s.modal,o)}))},t.matchList.prototype.filterUpdated=function(t){const a=this;let s={};t.forEach((t=>{s[t.name]={id:t.state.id,name:t.state.name}}));var l=a.buildRequestUrl(s),o=e.object.sameObject(a.lastConfig,l);a.lastConfig=l,a.activeConfig=s,o||(a.getNewPage(l),a.fixtures.innerHTML="",a.loader.classList.remove(r))},t.matchList.prototype.getNewPage=function(a){let s={url:a,headers:[t.accountHeader],method:"GET",callback:this.renderPage,forceCallback:!0,target:this};e.data.request(s.url,s.method,s.callback,s.target,null,{},s.headers)},t.matchList.prototype.buildRequestUrl=function(e){let a=`${t.environment.api}/voting/results/matches`;return parseInt(e.compSeasons.id)>0&&(a=`${a}?compSeasons=${e.compSeasons.id}`),parseInt(e.gameweekNumbers.id)>0&&(a=`${a}&matchWeekNumber=${e.gameweekNumbers.name}`),a},t.matchList.prototype.renderPage=function(e){const a=this;if(!e||!e.matchVotingResults||0===e.matchVotingResults.length)return a.loader.classList.add(r),void(a.fixtures.innerHTML=Mustache.render(t.templates.matchlistnodata,{message:l.lookup("label.kotm.nofixtures")}));let o=function(t,e){let a={};if(e.matchVotingResults&&e.matchVotingResults.length){let l;for(let o=0;o<e.matchVotingResults.length;o++)l=e.matchVotingResults[o],l.homeTeam.badge=s.getClubBadge(l.homeTeam.optaTeamId,"50","100"),l.awayTeam.badge=s.getClubBadge(l.awayTeam.optaTeamId,"50","100"),l.fixtureTime=moment(l.fixtureKickOffDateTimeInMillis).format("ddd D MMM YYYY"),l.fixtureTimeSmall=moment(l.fixtureKickOffDateTimeInMillis).format("L"),l.winner=t.getPollWinner(l.matchVotingInformation),a[l.matchWeekNumber]||(a[l.matchWeekNumber]=[]),a[l.matchWeekNumber].push(l)}return a}(a,e),n=Object.keys(o),i=[];for(let t=1;t<=n.length;t++){const e=n.length-t;let a=o[n[e]];const s={matchweek:n[e],matchweekFixtures:a,headerDate:l.lookup("label.date"),headerFixture:l.lookup("label.fixture"),headerKotm:l.lookup("label.kotm.name")};i.push(s)}a.fixtures.innerHTML+=Mustache.render(t.templates.matchlist,i);const c=a.fixtures.querySelectorAll(".js-kotm-image");Array.prototype.map.call(c,(function(t){s.setPlayerImageLoader(t.dataset.player,"110x140",t)}));const m=a.fixtures.querySelectorAll(".js-kotm-row");Array.prototype.map.call(m,(function(t){t.addEventListener("click",(t=>{a.matchId=t.currentTarget.dataset.match;const e=t.currentTarget.dataset.fixture;let s={player:t.currentTarget.dataset.player,fixture:e};a.trackEvent("Open modal",s),a.requestResults(e)}))})),a.loader.classList.add(r)},t.matchList.prototype.requestResults=function(a){const s=this;if("true"===e.url.getParam("webview")){const t={optaMatchId:a};"undefined"!=typeof Android&&Android?(l=t,"undefined"!=typeof Android&&Android&&Android.presentKOTMPollModal(l.optaMatchId)):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.presentKOTMPollModal.postMessage(t)}else{let l={url:`${t.environment.api}/voting/premierleague/results/${a}`,headers:[t.accountHeader],method:"GET",callback:s.viewResults,forceCallback:!0,target:s};e.data.request(l.url,l.method,l.callback,l.target,null,{},l.headers)}var l},t.matchList.prototype.viewResults=function(a){const s=this;new t.KotmResults(s.modal,a,s.matchId),e.style.toggleClass(s.modal,o)},t.matchList.prototype.getPollWinner=function(t){const e=t.nominatedPlayers.find((t=>!0===t.pollWinner));return{name:`${e.playerFirstName} ${e.playerLastName}`,id:e.optaPlayerId,firstName:e.playerFirstName,lastName:e.playerLastName}},t.matchList.prototype.dropDownOpened=function(t){const e=t.config.label;this.trackEvent(e+" clicked")},t.matchList.prototype.dropDownOptionSelected=function(t){this.trackEvent("Option "+t+" clicked")},t.matchList.prototype.filterCleared=function(t){this.trackEvent("Reset Filters"),this.filterUpdated(t)},t.matchList.prototype.trackEvent=function(a,s){let l={matchweek:this.activeConfig.gameweekNumbers.name,season:this.activeConfig.compSeasons.name};s&&(l=e.object.extend(l,s)),t.analytics.trackEvent({eventCategory:"KOTM Hub",eventLabel:a,eventAction:l})};t.filterGroups.setData((function(){let e=document.querySelectorAll('[data-widget="kotm-match-list"]');e=Array.prototype.map.call(e,(function(e){return new t.tabAwareWidget({widgetConstructor:t.matchList,widgetElement:e,widgetConfig:{}})}))}))}(PULSE.app,PULSE.core,PULSE.ui,PULSE.app.common,PULSE.I18N),function(t,e,a,s,l){let o=function(e,a){let s=r(e,e.filterState);for(let t in s)s[t]||(s[t]=void 0);return a&&(s.lastId=a),s.pageSize=e.pageSize,t.common.createVotingApiPath("voting.players",s)};var r=function(t,e){let a={};for(let t=0;t<e.length;t++)-1!=e[t].state.id&&e[t].active?a[e[t].name]=e[t].state.id:"stat"===e[t].name?a[e[t].name]="wins":a[e[t].name]=void 0;return a};t.PlayerStats=function(e){let a=this;a.element=e,a.playerStats=a.element.querySelector(".js-player-stats"),a.lastConfig={},a.pageSize=10,a.filterControllerElement=a.element.querySelector("section.pageFilter"),a.filterControllerElement&&(a.filterController=new s.listFilterController(a.filterControllerElement,{dropdowns:t.filterGroups[a.filterControllerElement.getAttribute("data-filter-config")],delegate:a,tracking:!0})),a.loader=new s.scrollLoader(a.playerStats,a,!0)},t.PlayerStats.prototype.updateTableColumn=function(){let t=this,e=t.filterState.find((t=>"stat"===t.name));t.statColumn=t.element.querySelector(".js-stat-column"),t.statColumn.innerHTML=l.lookup(e.state.name)},t.PlayerStats.prototype.gotFreshPage=function(t){let e=this;e.playerData=t.content,e.pageNumber=0,e.pagesTotal=Math.ceil(e.playerData.length/20),e.renderPage(e.playerData,!1),e.loader&&e.loader.reAppend()},t.PlayerStats.prototype.gotNextPage=function(t){let e=this;t.pageInfo&&(e.pageNumber=t.pageInfo.page,e.pagesTotal=t.pageInfo.numPages),e.renderPage(t.content,!0),e.loader},t.PlayerStats.prototype.nextPage=function(){let t=this;t.pageNumber++,t.renderPage(t.playerData,!0),t.loader&&t.loader.completedDataLoad(t.pageNumber>=t.pagesTotal)},t.PlayerStats.prototype.renderPage=function(e,a){let o=this;if(a||(o.playerStats.innerHTML=""),!a&&e&&e.length<1&&(o.filterState[0].state.id===t.newSeason.first?o.playerStats.innerHTML=Mustache.render(t.templates.matchlistnodata,{message:l.lookup("label.kotm.nofixtures.activeCompseason")}):o.playerStats.innerHTML=Mustache.render(t.templates.matchlistnodata,{message:l.lookup("label.kotm.nocontentmatches")})),o.loader&&o.loader.contentLoaded(),e&&e.length>0){const r=20*o.pageNumber;let n=function(t){return t.forEach((t=>{t.imageSize="110x140",t.defaultImage=s.getDefaultPlayerImg(t.imageSize),t.playerImage=s.getPlayerImg(t.optaPlayerId,t.imageSize),t.labelFor=l.lookup("label.photofor"),t.displayName=t.displayName?t.displayName:t.playerFirstName+" "+t.playerLastName,t.teamBadge=s.getClubBadge("t"+t.currentTeam,"50","100")})),t}(e.slice(r,r+20));o.lastId=e[e.length-1].optaPlayerId,n.playerHeader=l.lookup("label.player"),n.clubHeader=l.lookup("label.club"),n.statHeaderDesktop=l.lookup("label.kotm.name"),a?(o.tableBody=o.playerStats.querySelector(".js-kotm-table-body"),o.tableBody.insertAdjacentHTML("beforeend",Mustache.render(t.templates.playerstatnext,n))):(o.playerStats.innerHTML+=Mustache.render(t.templates.playerstatnew,n),o.updateTableColumn())}},t.PlayerStats.prototype.filterUpdated=function(t,a){let s=this,l=r(s,t),n=e.object.sameObject(s.lastConfig,l);s.lastConfig=l,s.filterState=t,n&&!a||(s.filterController.setPageLoading(s,s.playerStats),function(t){t.NewPageSubscriber={url:o(t),target:t,method:"GET",callback:t.gotFreshPage,forceCallback:!0},e.data.manager.add(t.NewPageSubscriber)}(s))},t.PlayerStats.prototype.didRequestLoad=function(){let t=this;t.filterState?setTimeout((function(){t.nextPage()}),500):setTimeout((function(){t.didRequestLoad()}),1e3)},t.PlayerStats.prototype.trackEvent=function(e){let a={},s=this.filterState;for(let t=0;t<s.length;t++)a[s[t].name]=s[t].state.name;t.analytics.trackEvent({eventCategory:"KOTM Hub",eventLabel:e,eventAction:a})},t.PlayerStats.prototype.dropDownOpened=function(t){const e=t.config.label;this.trackEvent(e+" clicked")},t.PlayerStats.prototype.dropDownOptionSelected=function(t){this.trackEvent("Option "+t+" clicked")},t.PlayerStats.prototype.filterCleared=function(t){this.trackEvent("Reset Filters")};t.filterGroups.setData((function(){let e=document.querySelectorAll('[data-widget="kotm-player-stats"]');e=Array.prototype.map.call(e,(function(e){return new t.PlayerStats(e,{})}))}))}(PULSE.app,PULSE.core,PULSE.ui,PULSE.app.common,PULSE.I18N);